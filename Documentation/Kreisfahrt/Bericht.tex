\documentclass[a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[ngerman]{babel}
\usepackage{amsmath}
\usepackage{nicefrac}
\usepackage{graphicx, wrapfig, float}
\usepackage[onehalfspacing]{setspace}
\usepackage{paralist}  % \begin{compactitem}
\usepackage{todonotes}

\title{Kreisfahrten mit einem Roboter mit Mecanum-Rädern}
\author{Manuel Fehmer \\ Thomas Feldmann \\ Marlene Feldmann \\ Carsten Hußmann}

\begin{document}
\maketitle
\begin{figure}
    \centering
    \includegraphics[width=.9\textwidth]{Abbildungen/Roboter}
    \caption{Der betrachtete Roboter mit montiertem Knickarm}
\end{figure}
\newpage

\section{Einleitung}
Der Mecanum-Roboter ist ein omnidirektionales Fahrzeug. Er kann ohne Lenkung aus jeder Position in eine beliebige Richtung fahren. Grund dafür sind die verwendeten Allseitenräder -- Mecanum-Räder -- auf deren Umlauffläche 15 weitere tonnenförmige Hilfsräder angebracht sind. Zur Steuerung des Roboters ist es notwendig, ein mathematisches Modell zur Beschreibung der einzelnen Bewegungen der Räder aufzustellen.

Ziel ist es, eine Kreisfahrt auf einem Viertelkreis mit dem Durchmesser $4000~mm$ auf drei Arten zu realisieren.

\begin{figure}[H]
    \centering
    \includegraphics[width=.6\textwidth]{Abbildungen/Viertelkreis-vorwaerts}
    \caption{Kreisfahrt vorwärts}
    \label{fig:kreis-vorwaerts}
\end{figure}
Der Mecanum-Roboter fährt einen normalen Viertelkreis. Das Koordinatensystem des Roboters dreht sich dabei während der Kreisfahrt mit, $y'$ ist Tangente an den gefahrenen Kreis.

\begin{figure}[H]
    \centering
    \includegraphics[width=.6\textwidth]{Abbildungen/Viertelkreis-translatorisch}
    \caption{Translatorische Kreisfahrt}
    \label{fig:kreis-translatorisch}
\end{figure}
Das Koordinatensystem des Roboters ist stets parallel zu den Raumkoordinaten während der Robotermittelpunkt im Raum einen Kreis abfährt.

\begin{figure}[H]
    \centering
    \includegraphics[width=.6\textwidth]{Abbildungen/Viertelkreis-seitwaerts}
    \caption{Kreisfahrt seitlich}
    \label{fig:kreis-seitwaerts}
\end{figure}
Das Koordinatensystem des Roboters gegenüber Abbildung~\ref{fig:kreis-vorwaerts} um $90^\circ$ gedreht. $x'$ ist Tangente an den gefahrenen Kreis.


\section{Mathematik zur Kinematik / Dynamik}
\begin{figure}
    \centering
    \includegraphics[width=.8\textwidth]{Abbildungen/Koordinaten}
    \caption{Bezugskoordinaten}
\end{figure}
Dieses Kapitel beschreibt die Mathematik hinter der Kinematik und Dynamik des Mecanum-Roboters.
Jede Bewegung setzt sich aus einer translatorischen und einer rotatorischen Bewegung zusammen.

\subsection{Translation}
Vereinfacht kann die translatorische Bewegung des Mecanum-Roboters durch die Drehrichtung und Drehgeschwindigkeit der Mecanum-Räder beschrieben werden. Abhängig von den unterschiedlichen Kombination fährt der Roboter entlang des Vektors für die Gesamtbewegung.
\begin{figure}[H]
    \centering
    \includegraphics[width=.6\textwidth]{Abbildungen/Kraefte-am-Rad}
    \caption{Kräftegleichgewicht an einem Mecanum-Rad.}
\end{figure}

Die Leistung einer vektoriellen Kraft berechnet sich nach:
$$ P_F = F_T \cdot v_F $$

Wirken Kraft und Geschwindigkeit entlang einer Koordinatenachse, haben beide Vektoren die gleiche Komponente ungleich null und ihr Skalarprodukt kann vereinfacht als Produkt der skalaren Größen betrachtet werden.

Die Kraftvektor in $x$- und $y$-Richtung setzt sich zusammen als die Summe der einzelnen $x$- und $y$-Vektoren der vier Räder:
\begin{align*}
    \sum_{i=1}^4 F_{iy} &= \sum_{i=1}^4 F_i \sin \alpha                 \\
    &= \sum_{i=1}^4 SIG \cdot K_i F_{Ti} \sin^2 \alpha                  \\
    &= \sum_{i=1}^4 SIG \cdot \frac{1}{2} K_i F_{Ti}                    \\
    \sum_{i=1}^4 F_{ix} &= \sum_{i=1}^4 F_i \cos \alpha                 \\
    &= \sum_{i=1}^4 (-1)^i SIG \cdot K_i F_{Ti} \sin \alpha \cos \alpha \\
    &= \sum_{i=1}^4 (-1)^i SIG \cdot \frac{1}{2} K_i F_{Ti}             \\
\end{align*}

SIG steht als Vorzeichenkonventionen für die Drehrichtung der Räder. Diese werden in der Steuerung direkt implementiert und werden daher bei den folgenden Rechnungen nicht weiter betrachtet.

Der Winkel $ \alpha $ liegt zwischen den Drehachsen der Rollen und der Räder ($\alpha = 45^\circ$).
Für eine translatorisch Bewegung müssen sich jeweils die diagonalen Räder (1, 3 und 2, 4) mit derselben Geschwindigkeit drehen. Entsprechen müssen ihre Kraftvektoren $F_{T1, 3} / F_{T2, 4}$ gleich groß sein.
Durch Auflösen der Summenzeichen erhält man ein Gleichungssystem:
\begin{align*}
    F_x &= - K_i F_{T1, 3} + K_i F_{T2, 4} \\
    F_y &= K_i F_{T1, 3}   + K_i F_{T2, 4}
\end{align*}

Nach Umstellen erhält man $F_{T1, 3}$ und $F_{T2, 4}$ und kann somit auch direkt die Geschwindigkeiten berechnen:
\begin{align*}
    F_{T1, 3} &= \frac{F_y + F_x}{K_i} &\Rightarrow v_{T1, 3} &= \frac{v_y + v_x}{K_i} \\
    F_{T2, 4} &= \frac{F_y - F_x}{K_i} &\Rightarrow v_{T2, 4} &= \frac{v_y - v_x}{K_i} \\
\end{align*}

Der Faktor $K_i$ setzt sich aus unterschiedlichen Faktoren zusammen, welche die durch das Motormoment erzeugten treibenden Kräfte beeinflussen und wird für den Boden der Werkstatt empirisch ermittelt.


\subsection{Rotation}
Die Rotation des Mecanum-Roboters um sein Zentrum kann durch die Drehrichtung der Räder bei gleicher Geschwindigkeit beschrieben werden.
Für eine Drehung im Uhrzeigersinn drehen Rad 1 und 2 rückwärts, Rad 3 und 4 vorwärts. Für eine Drehung gegen den Uhrzeigersinn entsprechend umgekehrt.
\begin{align*}
    v_{ref} &= K_i \cdot r \cdot \omega \\
    v_1 = v_4 &= - v_{ref}              \\
    v_2 = v_3 &= + v_{ref}
\end{align*}


\section{Koordinatentransformation}
Dieses Kapitel befasst sich mit der Koordinatentransformation vom ortsfesten Bezugskoordinatensystem zum Koordinatensystem des Mecanum-Roboters. \\
Die translatorische Verschiebung wird durch den Vektor $\underline T$ beschrieben.
\begin{align*}
\underline T =
\begin{bmatrix}
x_{T}\\
y_{T}\\
0
\end{bmatrix}
\end{align*}
Rotationsmatrix $\underline R$ um den Gierwinkel $\Psi$.
\begin{align*}
 \underline R_{\Psi} =
\begin{bmatrix}
  \cos{\Psi} & -\sin{\Psi} & 0\\
  \sin{\Psi} & \cos{\Psi} & 0\\
  0 & 0 & 1
\end{bmatrix}
\end{align*}
Positionsvektor des Roboter $\underline P$.
\begin{align*}
\underline P = \underline R_{\Psi} \cdot \underline T =
\begin{bmatrix}
  \cos{\Psi} & -\sin{\Psi} & 0\\
  \sin{\Psi} & \cos{\Psi} & 0\\
  0 & 0 & 1
\end{bmatrix}\cdot
\begin{bmatrix}
x_{T}\\
y_{T}\\
0
\end{bmatrix}=
\begin{bmatrix}
x_{T} \cdot \cos{\Psi}-y_{T} \cdot \sin{\Psi}\\
x_{T} \cdot \sin{\Psi}+y_{T}  \cdot \cos{\Psi}\\
0
\end{bmatrix}
\end{align*}
Als Ergänzung wird die Transformation bis zum Koordinatenursprung des montierten Roboterarms weitergeführt.
\begin{align*}
\underline T_{A} + \underline P =
\begin{bmatrix}
x_{A} + x_{T} \cdot \cos{\Psi}-y_{T} \cdot \sin{\Psi}\\
y_{A} + x_{T} \cdot \sin{\Psi}+y_{T}  \cdot \cos{\Psi}\\
z_{A}
\end{bmatrix}
\end{align*}


\section{Programmierung}
Der Roboter wird von einem Arduino Uno gesteuert, daher erfolgt die Programmierung in $C$. Das CAN-BUS Shield von SparkFun wird auf den Arduino aufgesteckt und ermöglicht die Kommunikation mit den Schrittmotortreibern STMCI47 der Firma Nanotec.
Für die Umsetzung einer Kreisfahrt gibt es zwei Möglichkeiten:

\begin{enumerate}
\item \emph{Explizit, iterativ:} \\
Dem Roboter wird in einem festgelegten Takt mit den neuen Sollgeschwindigkeiten für die Räder gespeist. Die Sollgeschwindigkeiten können zur Laufzeit berechnet werden oder aus einer Lookup-Tabelle stammen.

Ein zu langsam eingestellter Takt führt zu polygonalen Fahrverläufen, die den Sollkreis lediglich annähern. Dementsprechend ist diese Methode auch gegenüber Taktänderungen sehr anfällig, welche beispielsweise auftreten, wenn andere Prozesse im Mikrocontroller zu viel Rechenzeit benötigen.

\item \emph{Implizit, funktionell:} \\
Die Soll-Radgeschwindigkeiten werden als Funktion abhängig von der Zeit seit Beginn der Kreisfahrt definiert. Sie können zu jedem beliebigen Zeitpunkt abgefragt werden. Das erlaubt dem Mikrocontroller seine Rechenzeit frei einzuteilen und resultiert in ruckfreien, flüssigen Bewegungsabläufen.
\end{enumerate}

Wegen dieser Vorteile wird die implizite Definition der Fahrbewegung implementiert.
Der dafür notwendige Faktor K wurde für den Bodenbelag in der Werkstatt empirisch ermittelt.

Alle Fahrten werden über zwei Bezugsgrößen definiert: Die Winkelgeschwindigkeit $\omega(t)$ für die rotatorische- und die Richtungvektor $\underline{v}(t)$ für die translatorische Komponente der Fahrt. Das Bezugssystem sei hierbei das robotereigene Koordinatensystem.

In den Bewegungsabläufen \emph{Kreisfahrt vorwärts} (Abbildung~\ref{fig:kreis-vorwaerts}) und \emph{Kreisfahrt seitwärts} (Abbildung~\ref{fig:kreis-seitwaerts}) gilt $\omega = const$ und $\underline{v} = const$. $\omega$ und $\underline{v}$ müssen daher nur einmal berechnet werden.

Anders gestaltet sich die translatorische Kreisfahrt (Abbildung~\ref{fig:kreis-translatorisch}). Diese ist wie folgt definiert:
\begin{align*}
    \omega(t) &= 0 \\
    \underline{v}(t) &= v_0
        \begin{bmatrix}
            \cos(t \cdot k_t) \\
            \sin(t \cdot k_t)
        \end{bmatrix}
\end{align*}
Der Roboter behält dabei seine Geschwindigkeit über die gesamte Kreisfahrt bei, da $\left|\underline{v}\right| = const$. Die Fahrt wird gestoppt, sobald $v_x < 0$ wird, also nach dem geforderten Viertelkreis.


\section{Schlussteil}
Schnell hat sich herausgestellt, dass nur mit Kenntnis der Radgeschwindigkeiten keine genaue Positionierung möglich ist. Selbst kleinste Unebenheiten oder Verschmutzungen resultieren in starken Fahrbahnabweichungen. Für den produktiven Betrieb sind daher externe Positionsreferenzen notwendig, wie zum Beispiel eine Deckenkamera. Hinzu kommen einige mechanische Schwierigkeiten:

\begin{itemize}
    \item Die Motoren sind zu schwach dimensioniert und verlieren bei abrupten Manövern Schritte.
    \item Die Mecanum-Räder liegen zu nah am Riementrieb und verhaken sich regelmäßig mit den überstehenden Schrauben im Riemen.
    \item Das treibende Rad des Riementriebs löst sich nach längerem Gebrauch von der Welle und muss mit gezielten Hammerschlägen wieder an seine Position gebracht werden.
\end{itemize}

Dennoch wird mit dem behandelten Modell und dessen Implementierung bei einem Kreisdurchmesser von $4000 mm$ eine Reproduzierbarkeit auf wenige Zentimeter ($\pm 30 mm$) erreicht.
Dieser Fehler resultiert hauptsächlich aus der Unebenheit des Hallenbodens.


\end{document}
